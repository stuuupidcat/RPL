<!DOCTYPE HTML>
<html lang="en" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>The RPL Book</title>
        <meta name="robots" content="noindex">


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="highlight-css" href="highlight.css">
        <link rel="stylesheet" id="tomorrow-night-css" href="tomorrow-night.css">
        <link rel="stylesheet" id="ayu-highlight-css" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->


        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "";
            const default_light_theme = "light";
            const default_dark_theme = "navy";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="toc.js"></script>
    </head>
    <body>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            let sidebar = null;
            const sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="default_theme">Auto</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">The RPL Book</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="foreword"><a class="header" href="#foreword">Foreword</a></h1>
<p>RPL was conceived in the summer of 2024. At that time, I was conducting research and experimentation with various static analysis tools based on code pattern declarations, aiming to model and detect memory safety vulnerabilities in Rust. These tools exhibited varying degrees of complexity in their pattern declaration syntax, yet all operated on the abstract syntax tree. This led to a frustrating predicament: after spending hours crafting patterns and debugging toolchains, the slightest perturbation to the target code's AST—be it reordering statements or consolidating expressions—would render the patterns ineffective. After enduring this cycle repeatedly, I resolved to create a novel DSL that would preserve the strengths of existing tools (such as declaring patterns akin to writing Rust code) while addressing their shortcomings by enhancing pattern generalization. Furthermore, I planned to implement a self-contained parser and matcher for this DSL, building upon @TheVeryDarkness's enhanced <code>pest-typed</code> parser-generator framework. This vision swiftly garnered support from Professor @Colligence.</p>
<p>Through discussions with @Colligence, @shigma, and @TheVeryDarkness, RPL's syntactic design progressed smoothly. However, on the engineering front, I remained entangled in the labyrinthine branches of ASTs, pinning hopes on custom predicates (like <code>#without</code> and <code>#unordered</code>) and the capabilities of data flow analysis algorithms—a domain in which I possessed scant familiarity—to minimize the impact of syntactic noise on patterns. Additionally, my procrastination resulted in a project inception marked solely by documentation updates rather than code commits, let alone a rudimentary prototype.</p>
<p>Subsequent exchanges with @frank-king proved enlightening, as I gradually came to understand that declaring and matching patterns at Rust's distinctive MIR (Mid-Level Intermediate Representation) layer could effectively circumvent syntactic noise, thereby enabling more fundamental code pattern modeling. Over the ensuing ten months, with contributions from several fellow students, the RPL toolchain evolved into a functionally viable state. It became capable of scanning and analyzing open-source repositories based on existing patterns, yielding preliminary yet promising results.</p>
<p>@shigma inscribed in the "About" section of his open-source project Koishi: "Cross-platform chatbot framework made with love." To me, RPL resembles more the Bloodhound's Fang wielded by a wandering knight—an instrument that has spared me from numerous potential tribulations in life.</p>
<p><em>Carefully we wipe them hour by hour, And let no dust alight.</em></p>
<p>— stuuupidcat, 2025-04-24, Beijing</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="getting-started-with-rpl"><a class="header" href="#getting-started-with-rpl">Getting Started with RPL</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="installation"><a class="header" href="#installation">Installation</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="hello-world"><a class="header" href="#hello-world">Hello World</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="why-we-need-a-pattern-language-for-code"><a class="header" href="#why-we-need-a-pattern-language-for-code">Why We Need a Pattern Language for Code</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="quick-cli-tour-cargo-rpl"><a class="header" href="#quick-cli-tour-cargo-rpl">Quick CLI Tour: cargo rpl</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="language-fundamentals"><a class="header" href="#language-fundamentals">Language Fundamentals</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="syntax-overview"><a class="header" href="#syntax-overview">Syntax Overview</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="meta-variabl-es--placeholders"><a class="header" href="#meta-variabl-es--placeholders">Meta-Variabl es &amp; Placeholders</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="pattern-blocks"><a class="header" href="#pattern-blocks">Pattern Blocks</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="constraints--predicates"><a class="header" href="#constraints--predicates">Constraints &amp; Predicates</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="match-output--diagnostics"><a class="header" href="#match-output--diagnostics">Match Output &amp; Diagnostics</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="semantics-model"><a class="header" href="#semantics-model">Semantics Model</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="mir-basics-and-integration"><a class="header" href="#mir-basics-and-integration">MIR Basics and Integration</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="control-flow--data-dependence-graphs"><a class="header" href="#control-flow--data-dependence-graphs">Control-Flow &amp; Data-Dependence Graphs</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="semantic-equivalence-checking"><a class="header" href="#semantic-equivalence-checking">Semantic Equivalence Checking</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="inline-mir-vs-traditional-mir"><a class="header" href="#inline-mir-vs-traditional-mir">Inline MIR vs Traditional MIR</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="case-studies"><a class="header" href="#case-studies">Case Studies</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="memory-safety-cves"><a class="header" href="#memory-safety-cves">Memory-Safety CVEs</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="undefined-behavior"><a class="header" href="#undefined-behavior">Undefined Behavior</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="open-source-projects"><a class="header" href="#open-source-projects">Open-Source Projects</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="appendices"><a class="header" href="#appendices">Appendices</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="complete-syntax-reference"><a class="header" href="#complete-syntax-reference">Complete Syntax Reference</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="error-codes--remedies"><a class="header" href="#error-codes--remedies">Error Codes &amp; Remedies</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="patterns"><a class="header" href="#patterns">Patterns</a></h1>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->


                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">

            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->

        <script>
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>

    </div>
    </body>
</html>
